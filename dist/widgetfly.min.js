!function(root,factory){"use strict";"function"==typeof define&&define.amd?define([],function(){return root.Widgetfly=factory(root)}):root.Widgetfly=factory(root)}(this,function(){"use strict";var Widgetfly=function(){var Widgetfly={};return function(doc,cssText){var styleEl=doc.createElement("style");if(doc.getElementsByTagName("head")[0].appendChild(styleEl),styleEl.styleSheet)styleEl.styleSheet.disabled||(styleEl.styleSheet.cssText=cssText);else try{styleEl.innerHTML=cssText}catch(ignore){styleEl.innerText=cssText}}(document,'.widgetfly .wf-show,.widgetfly.wf-show{display:block !important}.widgetfly .wf-hide,.widgetfly.wf-hide{display:none !important}.widgetfly .wf-root,.widgetfly.wf-root{position:absolute;left:0;top:-9999px;width:47px;height:29px;z-index:999999999}.widgetfly .wf-spinner,.widgetfly.wf-spinner{width:70px;text-align:center}.widgetfly .wf-spinner div,.widgetfly.wf-spinner div{width:18px;height:18px;background-color:#333;border-radius:100%;display:inline-block;-webkit-animation:bouncedelay 1.4s infinite ease-in-out;animation:bouncedelay 1.4s infinite ease-in-out;-webkit-animation-fill-mode:both;animation-fill-mode:both}.widgetfly .wf-spinner .wf-bounce1,.widgetfly.wf-spinner .wf-bounce1{-webkit-animation-delay:-0.32s;animation-delay:-0.32s}.widgetfly .wf-spinner .wf-bounce2,.widgetfly.wf-spinner .wf-bounce2{-webkit-animation-delay:-0.16s;animation-delay:-0.16s}@-webkit-keyframes bouncedelay{0%,80%,100%{-webkit-transform:scale(0)}40%{-webkit-transform:scale(1)}}@keyframes bouncedelay{0%,80%,100%{transform:scale(0);-webkit-transform:scale(0)}40%{transform:scale(1);-webkit-transform:scale(1)}}.widgetfly .wf-panel,.widgetfly.wf-panel{width:100% !important;border:none !important;overflow:hidden !important}.widgetfly .wf-modal,.widgetfly.wf-modal{position:fixed;top:0;right:0;bottom:0;left:0;z-index:1050;overflow-x:hidden;overflow-y:auto;-webkit-overflow-scrolling:touch;outline:0;opacity:1}.widgetfly .wf-modal .wf-modal-dialog,.widgetfly.wf-modal .wf-modal-dialog{-webkit-transform:translate3d(0, 0, 0);-o-transform:translate3d(0, 0, 0);transform:translate3d(0, 0, 0);position:relative;margin:30px auto;width:600px}.widgetfly .wf-modal .wf-modal-dialog .wf-modal-content,.widgetfly.wf-modal .wf-modal-dialog .wf-modal-content{position:relative;background-color:#fff;border:1px solid #999;border:1px solid rgba(0,0,0,0.2);border-radius:6px;-webkit-box-shadow:0 5px 15px rgba(0,0,0,0.5);box-shadow:0 5px 15px rgba(0,0,0,0.5);background-clip:padding-box;outline:0}.widgetfly .wf-modal .wf-modal-dialog .wf-modal-content .wf-modal-body,.widgetfly.wf-modal .wf-modal-dialog .wf-modal-content .wf-modal-body{position:relative}.widgetfly .wf-modal .wf-modal-dialog .wf-modal-content .wf-close,.widgetfly.wf-modal .wf-modal-dialog .wf-modal-content .wf-close{position:absolute;right:0;margin-top:-2px;margin-right:5px;text-decoration:none;font-size:21px;font-weight:500;line-height:1;color:#000;text-shadow:0 1px 0 #fff;cursor:pointer;filter:alpha(opacity=50);opacity:.5;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;z-index:1050}.wf-modal-backdrop{position:fixed;top:0;right:0;bottom:0;left:0;z-index:1040;background-color:#000;filter:alpha(opacity=50);opacity:.5}.widgetfly .wf-popover,.widgetfly.wf-popover{top:0;left:0;z-index:1010;display:none;padding:1px;text-align:left;background-color:#fff;background-clip:padding-box;border:1px solid #ccc;border:1px solid rgba(0,0,0,0.2);border-radius:6px;-webkit-box-shadow:0 5px 10px rgba(0,0,0,0.2);box-shadow:0 5px 10px rgba(0,0,0,0.2);white-space:normal;position:absolute;display:block;float:left;width:260px}.widgetfly .wf-popover .wf-arrow,.widgetfly.wf-popover .wf-arrow{border-width:11px}.widgetfly .wf-popover .wf-arrow,.widgetfly.wf-popover .wf-arrow,.widgetfly .wf-popover .wf-arrow:after,.widgetfly.wf-popover .wf-arrow:after{position:absolute;display:block;width:0;height:0;border-color:transparent;border-style:solid;content:"";border-width:10px}.widgetfly .wf-popover.wf-top,.widgetfly.wf-popover.wf-top{margin-bottom:10px}.widgetfly .wf-popover.wf-top .wf-arrow,.widgetfly.wf-popover.wf-top .wf-arrow{bottom:-11px;left:50%;margin-left:-11px;border-top-color:#999;border-top-color:rgba(0,0,0,0.25);border-bottom-width:0}.widgetfly .wf-popover.wf-top .wf-arrow:after,.widgetfly.wf-popover.wf-top .wf-arrow:after{bottom:1px;margin-left:-10px;content:" ";border-top-color:#fff;border-bottom-width:0}.widgetfly .wf-popover.wf-left,.widgetfly.wf-popover.wf-left{margin-right:10px}.widgetfly .wf-popover.wf-left .wf-arrow,.widgetfly.wf-popover.wf-left .wf-arrow{top:50%;right:-11px;margin-top:-11px;border-right-width:0;border-left-color:#999;border-left-color:rgba(0,0,0,0.25)}.widgetfly .wf-popover.wf-left .wf-arrow:after,.widgetfly.wf-popover.wf-left .wf-arrow:after{right:1px;bottom:-10px;content:" ";border-right-width:0;border-left-color:#fff}.widgetfly .wf-popover.wf-bottom,.widgetfly.wf-popover.wf-bottom{margin-top:10px}.widgetfly .wf-popover.wf-bottom .wf-arrow,.widgetfly.wf-popover.wf-bottom .wf-arrow{top:-11px;left:50%;margin-left:-11px;border-top-width:0;border-bottom-color:#999;border-bottom-color:rgba(0,0,0,0.25)}.widgetfly .wf-popover.wf-bottom .wf-arrow:after,.widgetfly.wf-popover.wf-bottom .wf-arrow:after{top:1px;margin-left:-10px;content:" ";border-top-width:0;border-bottom-color:#fff}.widgetfly .wf-popover.wf-right,.widgetfly.wf-popover.wf-right{margin-left:10px}.widgetfly .wf-popover.wf-right .wf-arrow,.widgetfly.wf-popover.wf-right .wf-arrow{top:50%;left:-11px;margin-top:-11px;border-right-color:#999;border-right-color:rgba(0,0,0,0.25);border-left-width:0}.widgetfly .wf-popover.wf-right .wf-arrow:after,.widgetfly.wf-popover.wf-right .wf-arrow:after{bottom:-10px;left:1px;content:" ";border-right-color:#fff;border-left-width:0}'),Widgetfly.Utils=function(){var idCounter=0,Utils={has:function(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)},each:function(obj,iterator,context){var i,l,key;if(null===obj)return!1;if(Array.prototype.forEach&&obj.forEach===Array.prototype.forEach)obj.forEach(iterator,context);else if("number"==typeof obj.length){for(i=0,l=obj.length;l>i;i++)if(iterator.call(context,obj[i],i,obj)==={})return!1}else for(key in obj)if(Widgetfly.Utils.has(obj,key)&&iterator.call(context,obj[key],key,obj)==={})return!1},isEmpty:function(obj){if(null===obj)return!0;if(obj.length>0)return!1;if(0===obj.length)return!0;for(var key in obj)if(hasOwnProperty.call(obj,key))return!1;return!0},extend:function(obj){return this.each(Array.prototype.slice.call(arguments,1),function(source){if(source)for(var prop in source)obj[prop]=source[prop]}),obj},inherit:function(Child,Parent){var F=function(){};F.prototype=Parent.prototype,Child.prototype=new F,Child.prototype.constructor=Child,Child.uber=Parent.prototype},parseUrl:function(URL,checkLib){var nowSrc,parameter,i,tmpStr,tmpParam,createParam={};if("string"!=typeof URL&&URL.length>0?(URL=URL[URL.length-1],void 0!==URL.getAttribute.length&&(nowSrc=URL.getAttribute("src",-1))):nowSrc=URL,parameter=nowSrc.split("?",2),parameter.length>1&&(parameter=parameter[1],parameter=parameter.split("?"),parameter.length>0&&(parameter[0].split("=",2).length>0&&(createParam.type=parameter[0].split("=",2)[1]),void 0!==parameter[1]&&parameter[1].split("=",2).length>0&&""!==parameter[1].split("=",2)[1]&&(createParam.container=parameter[1].split("=",2)[1],"appendClass"===parameter[1].split("=",2)[0]?(createParam.appendType="class",createParam.dom="."+createParam.container):(createParam.appendType="id",createParam.dom="#"+createParam.container)),parameter.length>2)))for(createParam.options={},i=2;i<parameter.length;i++)parameter[i].split("=",2).length>0&&(tmpParam=parameter[i].split("=",2)[1],tmpParam=tmpParam.split(":"),tmpParam.length>0&&(tmpStr=tmpParam.shift(),0!==tmpParam.length&&(tmpParam=tmpParam.join(":"),""!==tmpParam&&null!==tmpParam&&"null"!==tmpParam&&(createParam.options[tmpStr]=tmpParam))));return void 0===checkLib?createParam:void checkLib(createParam)},uniqueId:function(prefix){var id=String(++idCounter);return prefix?prefix+id:id},getElementsByClassName:function(testClass,startFrom){for(var i=-1,results=[],finder=new RegExp("(?:^|\\s)"+testClass+"(?:\\s|$)"),a=startFrom&&startFrom.getElementsByTagName&&startFrom.getElementsByTagName("*")||document.all||document.getElementsByTagName("*"),l=a.length;++i<l;finder.test(a[i].className)&&results.push(a[i]));return a=null,results},inIframe:function(){try{return window.self!==window.top}catch(e){return!0}},isFunction:function(obj){return"function"==typeof obj},isElement:function(o){return"object"==typeof HTMLElement?o instanceof HTMLElement:o&&"object"==typeof o&&null!==o&&1===o.nodeType&&"string"==typeof o.nodeName},trans2Elem:function(element,startFrom){var target;return target="string"==typeof element?"#"===element.substr(0,1)?document.getElementById(element.replace("#","")):"."===element.substr(0,1)?this.getElementsByClassName(element.replace(".",""),startFrom)[0]:document.getElementsByTagName(element)[0]:element},hasClass:function(element,cls){return(" "+element.className+" ").indexOf(" "+cls+" ")>-1},addClass:function(element,className,startFrom){var target;void 0===startFrom&&(startFrom=document),target=this.trans2Elem(element,startFrom),this.hasClass(target,className)||(target.className+=" "+className),this.innerStyle(target)},removeClass:function(element,rmClass,startFrom){var target,newClass;if(void 0===startFrom&&(startFrom=document),target=this.trans2Elem(element,startFrom),void 0!==target&&this.isElement(target)&&(newClass=" "+target.className.replace(/[\t\r\n]/g," ")+" ",this.hasClass(target,rmClass))){for(;newClass.indexOf(" "+rmClass+" ")>=0;)newClass=newClass.replace(" "+rmClass+" "," ");target.className=newClass.replace(/^\s+|\s+$/g,"")}this.innerStyle(target)},toggleClass:function(element,className,startFrom){var target,newClass;if(void 0===startFrom&&(startFrom=document),target=this.trans2Elem(element,startFrom),void 0!==target&&this.isElement(target))if(newClass=" "+target.className.replace(/[\t\r\n]/g," ")+" ",this.hasClass(target,className)){for(;newClass.indexOf(" "+className+" ")>=0;)newClass=newClass.replace(" "+className+" "," ");target.className=newClass.replace(/^\s+|\s+$/g,"")}else target.className+=" "+className;this.innerStyle(target)},innerStyle:function(a){var i,r,match,ruleExp,result,rules,styles=[],sheets=document.styleSheets,o=[];a.matches=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector;for(i in sheets){rules=sheets[i].rules||sheets[i].cssRules;for(r in rules)a.matches(rules[r].selectorText)&&o.push(rules[r].cssText)}for(i in o)r=o[i],0===r.indexOf(".widgetfly")&&(ruleExp=/\{\s*([^\}]+)\s\}/g,match=ruleExp.exec(r),match&&styles.push(match[1]));result=styles.join(" "),a.hasAttribute("data-ext-style")&&(result=result+" "+a.getAttribute("data-ext-style")),a.style.cssText=result},actual:function(el){var elWidth,elHeight,style,fixStyle=" visibility: hidden !important; display: block !important; position: absolute !important;",size=function(s){return Boolean(s)?parseInt(s.substring(0,s.indexOf("px")),10):0};return null===el.offsetParent&&el.setAttribute("style",el.getAttribute("style")+fixStyle),elWidth=el.offsetWidth,elHeight=el.offsetHeight,style=el.getAttribute("style"),style&&0!==style.indexOf(fixStyle)&&el.setAttribute("style",style.substring(0,style.indexOf(fixStyle))),{width:elWidth+size(el.style.marginLeft)+size(el.style.marginRight),height:elHeight+size(el.style.marginTop)+size(el.style.marginBottom)}},offset:function(el){var docElem,win,elem=el,box={top:0,left:0},doc=elem&&elem.ownerDocument;if(doc)return docElem=doc.documentElement,void 0!==typeof elem.getBoundingClientRect&&(box=elem.getBoundingClientRect()),win=window,{top:box.top+win.pageYOffset-docElem.clientTop,left:box.left+win.pageXOffset-docElem.clientLeft}},toElement:function(content){var el=document.createElement("div");return el.innerHTML=content,el.firstChild}};return Utils}(this),Widgetfly.Events=function(){var Events=function(){};return Events.prototype.trigger=function(action,data){Widgetfly.Mediator.send(this.id,action,data)},Events.prototype.on=function(action,callback){Widgetfly.Mediator.bind(this.id,action,callback)},Events.prototype.off=function(action){Widgetfly.Mediator.unbind(this.id,action)},Events}(this),Widgetfly.Mediator=function(){var Mediator={widgets:{},actionHandlers:{},init:function(){var self=this;window.addEventListener("message",function(msgObj){self.receive(msgObj)},!1)},getWidget:function(id){return this.widgets[id]},getActionHandlers:function(id){return this.actionHandlers[id]},register:function(id,widget){this.widgets[widget.id]=widget,this.actionHandlers[widget.id]={}},unregister:function(id,callback){if(void 0!==this.actionHandlers[id]){var self=this;Widgetfly.Utils.each(this.actionHandlers[id],function(key){delete self.actionHandlers[id][key]})}delete this.widgets[id],callback(!0)},send:function(id,action,data){console.log("Mediator.send");var parser,targetOrigin,corsObj={msg:data,action:action,id:id},widget=this.widgets[id];widget&&(parser=window.document.createElement("a"),parser.href=widget.iframe.src,targetOrigin=parser.protocol+"//"+parser.host,widget.iframe.contentWindow.postMessage(corsObj,targetOrigin))},bind:function(id,action,callback){console.log("Mediator.bind: "+action),void 0===this.actionHandlers[id]&&(this.actionHandlers[id]={}),this.actionHandlers[id][action]=callback},unbind:function(id,action){console.log("Mediator.unbind"),delete this.actionHandlers[id][action],Object.keys(this.actionHandlers[id]).length<=0&&delete this.actionHandlers[id]},receive:function(msgObj){console.log("Mediator.receive");var origin,parser,widgetId=msgObj.data.id,widget=this.widgets[widgetId],myActionHandlers=this.actionHandlers[widgetId],action=msgObj.data.action;if(widget){if(parser=window.document.createElement("a"),parser.href=widget.iframe.src,origin=parser.protocol+"//"+parser.host,origin!==msgObj.origin)return void console.log("Widget ignore message from "+msgObj.origin);widget&&Widgetfly.Utils.isFunction(widget[action])?widget[action](msgObj.data.msg):!Widgetfly.Utils.isEmpty(myActionHandlers)&&Widgetfly.Utils.isFunction(myActionHandlers[action])&&myActionHandlers[action](msgObj.data.msg)}}};return Mediator}(this),Widgetfly.Server=function(){var Server=function(){this.id=window.name,this.events={},this.init()};return Widgetfly.Utils.inherit(Server,Widgetfly.Events),Server.prototype.init=function(){var self=this;this.trigger("start"),window.addEventListener("message",function(msgObj){if(window.parent){var action,origin,parser,params,paramData=decodeURIComponent(window.location.hash.substring(1));if(params=JSON.parse(paramData),parser=window.document.createElement("a"),parser.href=params.origin,origin=parser.protocol+"//"+parser.host,"file://"!==origin&&origin!==msgObj.origin)return void console.log("Server ignore message from "+msgObj.origin);action=msgObj.data.action,Widgetfly.Utils.isFunction(self[action])?self[action](msgObj.data.msg):!Widgetfly.Utils.isEmpty(self.events)&&Widgetfly.Utils.isFunction(self.events[action])&&self.events[action](msgObj.data.msg)}},!1)},Server.prototype.on=function(key,callback){this.events[key]=callback},Server.prototype.off=function(key){delete this.events[key]},Server.prototype.trigger=function(action,data){console.log("Server.trigger");var corsObj={msg:data,action:action,id:this.id},params=JSON.parse(decodeURIComponent(window.location.hash.substring(1)));parent.postMessage(corsObj,params.origin)},Server.prototype.show=function(){this.trigger("show")},Server.prototype.hide=function(){this.trigger("hide")},Server.prototype.onClose=function(callback){console.log("Server onClose action"),callback()},Server.prototype.close=function(){console.log("Prepare server close action");var self=this;Widgetfly.Utils.each(this.events,function(key){delete self.events[key]}),this.onClose(function(){console.log("Server close action"),self.trigger("close")})},Server.prototype.setSize=function(width,height){Widgetfly.Events.trigger(window.name,"sizeChange",width,height)},Server}(this),Widgetfly.Widget=function(){var Widget=function(){return this.id=Widgetfly.Utils.uniqueId("widget"),this};return Widget.DEFAULTS=Widgetfly.Utils.extend({},{spinner:'<div class="widgetfly wf-spinner"><div class="wf-bounce1"></div><div class="wf-bounce2"></div><div class="wf-bounce3"></div></div>'}),Widgetfly.Utils.inherit(Widget,Widgetfly.Events),Widget.prototype.getId=function(){return this.id},Widget.prototype.style=function(){var r=function(el){el.className&&Widgetfly.Utils.addClass(el,el.className);var i,j,nodes=el.childNodes;for(i in nodes)if(!nodes[i].className||0!==nodes[i].className.indexOf("widgetfly")&&0!==nodes[i].className.indexOf("wf-")||Widgetfly.Utils.addClass(nodes[i],nodes[i].className),nodes[i].childNodes)for(j in nodes[i].childNodes)r(nodes[i].childNodes[j])};r(this.el)},Widget.prototype.getIframe=function(){var iframe=this.el.querySelector("iframe");return iframe||"IFRAME"===this.el.tagName&&(iframe=this.el),iframe},Widget.prototype.onStart=function(callback){Widgetfly.Utils.isFunction(callback)&&this.on("onStart",callback)},Widget.prototype.start=function(){console.log("Widget.Action start");var handlers=Widgetfly.Mediator.getActionHandlers(this.id);handlers&&Widgetfly.Utils.isFunction(handlers.onStart)&&handlers.onStart(),this.spinner&&this.container===this.spinner.parentNode&&this.container.removeChild(this.spinner),this.options.show?this.show():this.hide()},Widget.prototype.onHide=function(callback){Widgetfly.Utils.isFunction(callback)&&this.on("onHide",callback)},Widget.prototype.hide=function(){console.log("Widget.Action hide"),Widgetfly.Utils.removeClass(this.el,"wf-show"),Widgetfly.Utils.removeClass(this.el,"wf-hide"),Widgetfly.Utils.addClass(this.el,"wf-hide");var handlers=Widgetfly.Mediator.getActionHandlers(this.id);handlers&&Widgetfly.Utils.isFunction(handlers.onHide)&&handlers.onHide()},Widget.prototype.onShow=function(callback){Widgetfly.Utils.isFunction(callback)&&this.on("onShow",callback)},Widget.prototype.show=function(){console.log("Widget.Action show");var handlers;Widgetfly.Utils.removeClass(this.el,"wf-show"),Widgetfly.Utils.removeClass(this.el,"wf-hide"),Widgetfly.Utils.addClass(this.el,"wf-show"),handlers=Widgetfly.Mediator.getActionHandlers(this.id),handlers&&Widgetfly.Utils.isFunction(handlers.onShow)&&handlers.onShow()},Widget.prototype.onBeforeClose=function(callback){Widgetfly.Utils.isFunction(callback)&&this.on("onBeforeClose",callback)},Widget.prototype.close=function(){console.log("Widget.Action close");var r,handlers,self=this;handlers=Widgetfly.Mediator.getActionHandlers(this.id),handlers&&Widgetfly.Utils.isFunction(handlers.onBeforeClose)&&(r=handlers.onBeforeClose()),r!==!1&&Widgetfly.Mediator.unregister(this.id,function(){self.container.removeChild(self.el)})},Widget.prototype.register=function(){var nowScripts=document.getElementsByTagName("script"),cScript=nowScripts[nowScripts.length-1];Widgetfly.Mediator.register(this.id,this),cScript.setAttribute("data-id",this.id)},Widget.prototype.render=function(){var src,iframe,origin,urlOptions;return origin="file:"===window.location.protocol?window.location.protocol+"//"+window.location.pathname:window.location.protocol+"//"+window.location.host,urlOptions={origin:origin,options:this.options.options},this.spinner=Widgetfly.Utils.toElement(this.options.spinner),this.options.show?(Widgetfly.Utils.removeClass(this.spinner,"wf-show wf-hide"),Widgetfly.Utils.addClass(this.spinner,"wf-show")):(Widgetfly.Utils.removeClass(this.spinner,"wf-show wf-hide"),Widgetfly.Utils.addClass(this.spinner,"wf-hide")),this.el=Widgetfly.Utils.toElement(this.options.template),iframe=this.getIframe(),iframe.setAttribute("name",this.id),src=-1===this.options.src.indexOf("#")?this.options.src+"#":this.options.src.substring(0,this.options.src.indexOf("#"))+"#",src+=encodeURIComponent(JSON.stringify(urlOptions)),iframe.setAttribute("src",src),iframe},Widget}(this),Widgetfly.Panel=function(){var Panel=function(options){if(Widgetfly.Widget.apply(this,arguments),this.options=Widgetfly.Utils.extend({},Panel.DEFAULTS,options),void 0===options||void 0===options.container||null===options.container)return!1;if(this.container=window.document.querySelector(options.container),this.container&&this.container.length<=0)return!1;if(this.register(this.id),this.render(),this.iframe=this.getIframe(),this.style(),this.container){for(options.show?this.show():this.hide();this.container.hasChildNodes();)this.container.removeChild(this.container.lastChild);this.container.appendChild(this.el)}return this};return Panel.DEFAULTS=Widgetfly.Utils.extend({},Widgetfly.Widget.DEFAULTS,{autoGrow:!1,show:!0,template:'<iframe allowtransparency="true" frameborder="0" tabindex="0" title="Widgetfly Widget" width="100%" verticalscrolling="no" scrolling="no" horizontalscrolling="no" class="widgetfly wf-panel wf-hide"></iframe>',options:{}}),Widgetfly.Utils.inherit(Panel,Widgetfly.Widget),Panel.prototype.close=function(){console.log("Widget.Action close");var r,handlers,self=this;handlers=Widgetfly.Mediator.getActionHandlers(this.id),handlers&&Widgetfly.Utils.isFunction(handlers.onBeforeClose)&&(r=handlers.onBeforeClose()),r!==!1&&Widgetfly.Mediator.unregister(this.id,function(){self.container.remove(0)})},Panel}(this),Widgetfly.Modal=function(){var Modal=function(options){var self=this;return Widgetfly.Widget.apply(this,arguments),this.options=Widgetfly.Utils.extend({},Modal.DEFAULTS,options),this.container=window.document.querySelector("body"),void 0===options?!1:(document.querySelector(".wf-modal")&&this.container.removChild(document.querySelector(".wf-modal")),document.querySelector(".wf-modal-backdrop")&&this.container.removChild(document.querySelector(".wf-modal-backdrop")),this.register(this.id),this.container&&(this.render(),this.iframe=this.getIframe(),this.backdrop=window.document.createElement("div"),this.el.querySelector(".wf-close").onclick=function(){self.close()},Widgetfly.Utils.addClass(this.backdrop,"widgetfly wf-modal-backdrop in"),this.container.appendChild(this.backdrop),this.style(),options.show?this.show():this.hide(),this.container.appendChild(this.el)),this)};return Modal.DEFAULTS=Widgetfly.Utils.extend({},Widgetfly.Widget.DEFAULTS,{autoGrow:!1,show:!0,backdrop:!0,template:'<div class="widgetfly wf-modal"><div class="wf-modal-dialog"><div class="wf-modal-content"><a class="wf-close" href="javascript:void(0)">x</a><iframe allowtransparency="true" frameborder="0" tabindex="0" title="Widgetfly Widget" width="100%" verticalscrolling="no" scrolling="no" horizontalscrolling="no" class="wf-modal-body wf-show"></iframe></div></div></div>',options:{}}),Widgetfly.Utils.inherit(Modal,Widgetfly.Widget),Modal.prototype.sizeChange=function(size){document.getElementsByName(this.id)[0].height=size+"px"},Modal.prototype.show=function(){Widgetfly.Widget.prototype.show.apply(this,arguments),Widgetfly.Utils.removeClass(this.backdrop,"wf-show wf-hide"),Widgetfly.Utils.addClass(this.backdrop,"wf-show")},Modal.prototype.hide=function(){Widgetfly.Widget.prototype.hide.apply(this,arguments),Widgetfly.Utils.removeClass(this.backdrop,"wf-show wf-hide"),Widgetfly.Utils.addClass(this.backdrop,"wf-hide")},Modal.prototype.close=function(){console.log("Widget.Action close");var r,handlers,self=this;handlers=Widgetfly.Mediator.getActionHandlers(this.id),handlers&&Widgetfly.Utils.isFunction(handlers.onBeforeClose)&&(r=handlers.onBeforeClose()),r!==!1&&Widgetfly.Mediator.unregister(this.id,function(){self.container.removeChild(self.el),self.container.removeChild(self.backdrop)})},Modal}(this),Widgetfly.Popover=function(){var Popover=function(options){return Widgetfly.Widget.apply(this,arguments),this.options=Widgetfly.Utils.extend({},Popover.DEFAULTS,options),this.container=window.document.querySelector("body"),void 0===options||void 0===options.target||null===options.target?!1:(this.register(this.id),this.target=window.document.querySelector(options.target),this.target&&this.target.length<=0?!1:(this.render(),this.iframe=this.getIframe(),this.style(),this.container&&(this.container.appendChild(this.el),this.applyPlacement(),options.show?this.show():this.hide()),this))};return Popover.DEFAULTS=Widgetfly.Utils.extend({},Widgetfly.Widget.DEFAULTS,{autoGrow:!1,show:!0,placement:"right",template:'<div class="widgetfly wf-popover wf-hide"><div class="wf-arrow"></div><iframe allowtransparency="true" frameborder="0" tabindex="0" title="Widgetfly Widget" width="100%" verticalscrolling="no" scrolling="no" horizontalscrolling="no" class="wf-popover-content"></iframe></div>',options:{}}),Widgetfly.Utils.inherit(Popover,Widgetfly.Widget),Popover.prototype.style=function(){var placement=this.options.placement;placement||(placement="right"),Widgetfly.Utils.addClass(this.el,"wf-"+placement),Widgetfly.Widget.prototype.style.apply(this,arguments)},Popover.prototype.applyPlacement=function(){var top,left,offset=Widgetfly.Utils.offset(this.target),tg=Widgetfly.Utils.actual(this.target),el=Widgetfly.Utils.actual(this.el);"left"===this.options.placement?(top=offset.top+Math.round(tg.height/2)-Math.round(el.height/2),left=offset.left-el.width):"top"===this.options.placement?(top=offset.top-el.height,left=offset.left+Math.round(tg.width/2)-Math.round(el.width/2)):"bottom"===this.options.placement?(top=offset.top+tg.height,left=offset.left+Math.round(tg.width/2)-Math.round(el.width/2)):(top=offset.top+Math.round(tg.height/2)-Math.round(el.height/2),left=offset.left+tg.width),this.el.setAttribute("data-ext-style","top: "+top+"px; left:"+left+"px;")},Popover}(this),function(){var nowScripts,param,extend=function(protoProps,staticProps){var child,Surrogate,parent=this;return child=protoProps&&Widgetfly.Utils.has(protoProps,"constructor")?protoProps.constructor:function(){return parent.apply(this,arguments)},Widgetfly.Utils.extend(child,parent,staticProps),Surrogate=function(){this.constructor=child},Surrogate.prototype=parent.prototype,child.prototype=new Surrogate,protoProps&&Widgetfly.Utils.extend(child.prototype,protoProps),child.__super__=parent.prototype,child};Widgetfly.Panel.extend=Widgetfly.Modal.extend=Widgetfly.Popover.extend=Widgetfly.Server.extend=extend,nowScripts=document.getElementsByTagName("script"),param=Widgetfly.Utils.parseUrl(nowScripts),Widgetfly.Utils.inIframe()?console.log("Now is Server initialize"):(console.log("Now is Widgets initialize"),Widgetfly.Mediator.init(),Widgetfly.Utils.isEmpty(param)||new Widgetfly.Panel(param))}(this),Widgetfly}(this);return Widgetfly});
//# sourceMappingURL=widgetfly.min.js.map